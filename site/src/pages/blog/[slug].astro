---
import Layout from "../../layouts/Layout.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export async function getStaticPaths() {
	const posts = (await getCollection("blog")).filter((post) => !post.data.draft);
	return posts.map((post) => ({ params: { slug: post.slug } }));
}

const { slug } = Astro.params;
const post = await getEntryBySlug("blog", slug!);
if (!post || post.data.draft) {
	return Astro.redirect("/blog");
}

const { Content } = await post.render();

const formatter = new Intl.DateTimeFormat("en-US", {
	year: "numeric",
	month: "long",
	day: "numeric",
});
---

<Layout title={`${post.data.title} — Guy Abi Hanna`} description={post.data.description}>
	<article>
		<h1>{post.data.title}</h1>
		<p class="small">
			{formatter.format(post.data.pubDate)}
			{post.data.updatedDate ? ` · Updated ${formatter.format(post.data.updatedDate)}` : ""}
		</p>
		<Content />
	</article>
</Layout>
